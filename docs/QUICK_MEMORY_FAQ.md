# –ë—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é –≤ Aurora

## –ö—Ç–æ —Å–ª–µ–¥–∏—Ç –∑–∞ –ø–∞–º—è—Ç—å—é –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –º–∞—Å—Å–∏–≤–æ–≤?

**–ö–æ—Ä–æ—Ç–∫–∏–π –æ—Ç–≤–µ—Ç:** `std::vector<T>` –∏ –º–µ—Ö–∞–Ω–∏–∑–º RAII –≤ C++.

**–ü–æ–¥—Ä–æ–±–Ω–æ:**

### 1. –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –º–∞—Å—Å–∏–≤–∞

```aurora
let arr = [1, 2, 3, 4, 5];
```

‚Üì –ö–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –≤:

```cpp
std::vector<int> arr = std::vector<int>{1, 2, 3, 4, 5};
```

**–í–Ω—É—Ç—Ä–∏ `std::vector`:**
- ‚úÖ –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–¥–µ–ª—è–µ—Ç heap –ø–∞–º—è—Ç—å
- ‚úÖ –ö–æ–ø–∏—Ä—É–µ—Ç —ç–ª–µ–º–µ–Ω—Ç—ã –≤ –≤—ã–¥–µ–ª–µ–Ω–Ω—É—é –ø–∞–º—è—Ç—å
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —É–∫–∞–∑–∞—Ç–µ–ª—å, —Ä–∞–∑–º–µ—Ä –∏ capacity

### 2. –ö—Ç–æ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –ø–∞–º—è—Ç—å?

**–î–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä `~vector()`** - –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ scope:

```cpp
{
    std::vector<int> arr{1, 2, 3};
    // ... –∏—Å–ø–æ–ª—å–∑—É–µ–º –º–∞—Å—Å–∏–≤ ...
} // <- –ó–¥–µ—Å—å –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è ~vector()
  //    –∏ –í–°–Ø –ø–∞–º—è—Ç—å –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è
```

### 3. RAII = –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

**RAII** (Resource Acquisition Is Initialization):

1. **–ó–∞—Ö–≤–∞—Ç —Ä–µ—Å—É—Ä—Å–∞** ‚Üí –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ (malloc/new)
2. **–û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞** ‚Üí –≤ –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ (free/delete)
3. **–í—ã–∑–æ–≤ –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞** ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–æ–º

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚ùå –ù–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –≤—ã–∑—ã–≤–∞—Ç—å `free()` –∏–ª–∏ `delete`
- ‚ùå –ù–µ –Ω—É–∂–Ω–æ —Å–ª–µ–¥–∏—Ç—å –∑–∞ —É—Ç–µ—á–∫–∞–º–∏
- ‚úÖ –ü–∞–º—è—Ç—å –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ
- ‚úÖ –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏–º–∏ –ø–æ–¥—Ö–æ–¥–∞–º–∏

### Python/Java/JavaScript (Garbage Collection)

```python
arr = [1, 2, 3, 4, 5]
# –ü–∞–º—è—Ç—å –æ—Å–≤–æ–±–æ–¥–∏—Ç—Å—è... –∫–æ–≥–¥–∞-–Ω–∏–±—É–¥—å... –∫–æ–≥–¥–∞ GC –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è...
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- üêå –ù–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–µ –ø–∞—É–∑—ã GC
- üêå Overhead –Ω–∞ tracing/reference counting
- ‚ùì –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ –ö–û–ì–î–ê –ø–∞–º—è—Ç—å –æ—Å–≤–æ–±–æ–¥–∏—Ç—Å—è

### C (–†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ)

```c
int* arr = malloc(5 * sizeof(int));
// ... –∏—Å–ø–æ–ª—å–∑—É–µ–º ...
free(arr);  // –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –≤—Ä—É—á–Ω—É—é!
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- üí£ –ó–∞–±—ã–ª `free()` ‚Üí —É—Ç–µ—á–∫–∞ –ø–∞–º—è—Ç–∏
- üí£ –î–≤–æ–π–Ω–æ–π `free()` ‚Üí undefined behavior
- üí£ Use after free ‚Üí –∫—Ä–∞—Ö –ø—Ä–æ–≥—Ä–∞–º–º—ã
- üò∞ –ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç —Å–∞–º —Å–ª–µ–¥–∏—Ç –∑–∞ –≤—Å–µ–º

### Aurora/C++ (RAII)

```aurora
let arr = [1, 2, 3, 4, 5];
// –ü–∞–º—è—Ç—å –æ—Å–≤–æ–±–æ–¥–∏—Ç—Å—è –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ scope
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
- ‚úÖ –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ
- ‚úÖ –ù–µ—Ç overhead –Ω–∞ GC
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ
- ‚úÖ Compile-time –≥–∞—Ä–∞–Ω—Ç–∏–∏

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### Memory layout

```
std::vector<int> arr{1, 2, 3, 4, 5};

Stack (–±—ã—Å—Ç—Ä–æ):              Heap (—É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è vector):
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê            ‚îå‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îê
‚îÇ data   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ 1 ‚îÇ 2 ‚îÇ 3 ‚îÇ 4 ‚îÇ 5 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§            ‚îî‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îò
‚îÇ size = 5     ‚îÇ              ^ –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π –±–ª–æ–∫
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§              ^ Cache-friendly!
‚îÇ capacity = 5 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –°–∞–º –æ–±—ä–µ–∫—Ç `vector` –Ω–∞ —Å—Ç–µ–∫–µ (3 —Å–ª–æ–≤–∞: —É–∫–∞–∑–∞—Ç–µ–ª—å, size, capacity)
- –î–∞–Ω–Ω—ã–µ –Ω–∞ heap, –Ω–æ –≤ **–Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–º –±–ª–æ–∫–µ**
- –û—Ç–ª–∏—á–Ω–∞—è cache locality ‚Üí –≤—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

## –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

### Push (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ)

```aurora
arr.push(10)
```

‚Üí C++: `arr.push_back(10)`

**–ï—Å–ª–∏ –º–µ—Å—Ç–∞ —Ö–≤–∞—Ç–∞–µ—Ç:**
- –ü—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–ª—è–µ—Ç —ç–ª–µ–º–µ–Ω—Ç
- **O(1)** –æ–ø–µ—Ä–∞—Ü–∏—è

**–ï—Å–ª–∏ –Ω—É–∂–Ω–∞ —Ä–µ–∞–ª–ª–æ–∫–∞—Ü–∏—è:**
1. –í—ã–¥–µ–ª—è–µ—Ç –Ω–æ–≤—ã–π –±—É—Ñ–µ—Ä (–æ–±—ã—á–Ω–æ x2)
2. –ö–æ–ø–∏—Ä—É–µ—Ç/–ø–µ—Ä–µ–º–µ—â–∞–µ—Ç —Å—Ç–∞—Ä—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
3. **–û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç —Å—Ç–∞—Ä—ã–π –±—É—Ñ–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**
4. –î–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç
- **O(n)** –æ–ø–µ—Ä–∞—Ü–∏—è, –Ω–æ **–∞–º–æ—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ O(1)**

### –í–∞–∂–Ω–æ: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ –±—É—Ñ–µ—Ä–∞!

```cpp
arr.push_back(10);  // –ú–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å —Ä–µ–∞–ª–ª–æ–∫–∞—Ü–∏—é
// –°—Ç–∞—Ä–∞—è –ø–∞–º—è—Ç—å –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò
// –ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ—Ç
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### Exception safety

```cpp
{
    std::vector<int> arr{1, 2, 3};

    // –î–∞–∂–µ –µ—Å–ª–∏ –≤—ã–±—Ä–æ—à–µ–Ω–æ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ:
    throw std::runtime_error("Boom!");

} // <- –î–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä ~vector() –í–°–Å –†–ê–í–ù–û –≤—ã–∑–æ–≤–µ—Ç—Å—è!
  //    –ü–∞–º—è—Ç—å –±—É–¥–µ—Ç –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∞!
```

**Stack unwinding** –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –≤—ã–∑–æ–≤ –≤—Å–µ—Ö –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–≤.

## –ò—Ç–æ–≥

**–î–ª—è –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–∞ Aurora:**
```aurora
let arr = [1, 2, 3];
arr.push(4);
arr.push(5);
// –í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç "–º–∞–≥–∏—á–µ—Å–∫–∏"
// –ù–∏–∫–∞–∫–∏—Ö —É—Ç–µ—á–µ–∫
// –ù–∏–∫–∞–∫–∏—Ö segfault
// –ü—Ä–æ—Å—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚ú®
```

**–ü–æ–¥ –∫–∞–ø–æ—Ç–æ–º:**
1. `std::vector` —É–ø—Ä–∞–≤–ª—è–µ—Ç heap –ø–∞–º—è—Ç—å—é
2. –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –≤—ã–¥–µ–ª—è–µ—Ç –ø–∞–º—è—Ç—å
3. **–î–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò**
4. –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä C++ –≤—Å—Ç–∞–≤–ª—è–µ—Ç –≤—ã–∑–æ–≤—ã –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–≤
5. RAII –¥–µ–ª–∞–µ—Ç –≤—Å—é –≥—Ä—è–∑–Ω—É—é —Ä–∞–±–æ—Ç—É

**–ì–ª–∞–≤–Ω—ã–π –ø—Ä–∏–Ω—Ü–∏–ø:**
> **–ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç –¥—É–º–∞–µ—Ç –æ –¥–∞–Ω–Ω—ã—Ö, –∞ –Ω–µ –æ –ø–∞–º—è—Ç–∏**

–ò–º–µ–Ω–Ω–æ –¥–ª—è —ç—Ç–æ–≥–æ –∏ —Å–æ–∑–¥–∞–Ω RAII! üéâ

# CodeRabbit Review Guide –¥–ª—è cpp_ast_v3

## –û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞

**cpp_ast_v3** - —ç—Ç–æ Ruby DSL –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏ C++ –∫–æ–¥–∞ —Å –ø–æ–ª–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π roundtrip, –∞ —Ç–∞–∫–∂–µ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä —è–∑—ã–∫–∞ Aurora, –∫–æ—Ç–æ—Ä—ã–π —Ç—Ä–∞–Ω—Å–ª–∏—Ä—É–µ—Ç –≤ C++20.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **C++ AST DSL** (`lib/cpp_ast/`)
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è C++ –∫–æ–¥–∞ –∏–∑ Ruby DSL
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–ª–∞—Å—Å–æ–≤, —Ñ—É–Ω–∫—Ü–∏–π, –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤ –∏–º–µ–Ω
   - Roundtrip: C++ ‚Üí AST ‚Üí C++

2. **Aurora Language** (`lib/aurora/`)
   - –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —è–∑—ã–∫
   - –ö–æ–º–ø–∏–ª—è—Ü–∏—è –≤ C++20 —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `std::variant`, `std::visit`
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ sum types, pattern matching, generics

3. **CoreIR** (`lib/aurora/passes/`)
   - –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –º–µ–∂–¥—É Aurora AST –∏ C++ AST
   - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã —Ä–µ–≤—å—é

### üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï (Critical)
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø–∞–º—è—Ç–∏**: —É—Ç–µ—á–∫–∏, double-free, buffer overflows
- **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –ø–∞—Ä—Å–∏–Ω–≥–∞**: –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ AST, –ø–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö
- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –±–∞–≥–∏**: segmentation faults, infinite loops
- **–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞**: —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏ –Ω–µ–≤–µ—Ä–Ω—ã–π C++

### üü† –°–ï–†–¨–ï–ó–ù–´–ï (Major)
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: O(n¬≤) –∞–ª–≥–æ—Ä–∏—Ç–º—ã, –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ –∞–ª–ª–æ–∫–∞—Ü–∏–∏
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã**: tight coupling, –Ω–∞—Ä—É—à–µ–Ω–∏–µ SOLID
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ error handling, –Ω–µ–∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ –æ—à–∏–±–∫–∏
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—É—Ç–µ–π

### üü° –°–†–ï–î–ù–ò–ï (Minor)
- **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å –∫–æ–¥–∞**: —Å–ª–æ–∂–Ω—ã–µ –º–µ—Ç–æ–¥—ã, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –Ω–µ–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ API, —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –ø—Ä–∏–º–µ—Ä—ã
- **–°—Ç–∏–ª—å –∫–æ–¥–∞**: –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ Ruby conventions

## –î–µ—Ç–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º

### 1. C++ AST DSL (`lib/cpp_ast/`)

#### –ß—Ç–æ —Ä–µ–≤—å—é–∏—Ç—å:
- **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏**: –ø—Ä–æ–≤–µ—Ä—è–π, —á—Ç–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–π C++ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è
- **Roundtrip —Ç–µ—Å—Ç—ã**: C++ ‚Üí AST ‚Üí C++ –¥–æ–ª–∂–µ–Ω —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Å–µ–º–∞–Ω—Ç–∏–∫—É
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –∏–∑–±–µ–≥–∞–π O(n¬≤) –æ–ø–µ—Ä–∞—Ü–∏–π –≤ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞—Ö

#### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:
```ruby
# ‚ùå –ü–õ–û–•–û: –ü—Ä—è–º–∞—è –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—è —Å—Ç—Ä–æ–∫
result = ""
nodes.each { |node| result += node.to_cpp }

# ‚úÖ –•–û–†–û–®–û: StringBuilder –∏–ª–∏ –º–∞—Å—Å–∏–≤
result = nodes.map(&:to_cpp).join("\n")
```

#### –§–∞–π–ª—ã –¥–ª—è –æ—Å–æ–±–æ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è:
- `lib/cpp_ast/builder/dsl_generator.rb` - –æ—Å–Ω–æ–≤–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä
- `lib/cpp_ast/builder/optimized_generator.rb` - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä
- `test/builder/` - —Ç–µ—Å—Ç—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

### 2. Aurora Language (`lib/aurora/`)

#### –ß—Ç–æ —Ä–µ–≤—å—é–∏—Ç—å:
- **–ü–∞—Ä—Å–∏–Ω–≥**: –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å AST, –æ–±—Ä–∞–±–æ—Ç–∫–∞ edge cases
- **–¢–∏–ø–∏–∑–∞—Ü–∏—è**: –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤, inference
- **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è C++**: –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏ –≤ C++20

#### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:
```ruby
# ‚ùå –ü–õ–û–•–û: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∏–ø–æ–≤
def generate_function(func)
  "int #{func.name}() { return #{func.body}; }"
end

# ‚úÖ –•–û–†–û–®–û: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤
def generate_function(func)
  return_type = map_aurora_type_to_cpp(func.return_type)
  "int #{func.name}() { return #{func.body}; }"
end
```

#### –§–∞–π–ª—ã –¥–ª—è –æ—Å–æ–±–æ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è:
- `lib/aurora/parser/parser.rb` - –æ—Å–Ω–æ–≤–Ω–æ–π –ø–∞—Ä—Å–µ—Ä
- `lib/aurora/parser/optimized_parser.rb` - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–∞—Ä—Å–µ—Ä
- `lib/aurora/passes/to_core.rb` - —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ CoreIR
- `lib/aurora/ast/nodes.rb` - AST —É–∑–ª—ã

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (`test/`)

#### –ß—Ç–æ —Ä–µ–≤—å—é–∏—Ç—å:
- **–ü–æ–∫—Ä—ã—Ç–∏–µ**: –≤—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—É—Ç–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–∫—Ä—ã—Ç—ã
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã**: –ø–æ–ª–Ω—ã–µ pipeline —Ç–µ—Å—Ç—ã
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: benchmark —Ç–µ—Å—Ç—ã

#### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:
```ruby
# ‚ùå –ü–õ–û–•–û: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
def test_parsing
  parser.parse("fn test() = 42")
end

# ‚úÖ –•–û–†–û–®–û: –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
def test_parsing
  ast = parser.parse("fn test() = 42")
  assert_equal 1, ast.declarations.length
  assert_equal "test", ast.declarations.first.name
end
```

### 4. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

#### –ß—Ç–æ —Ä–µ–≤—å—é–∏—Ç—å:
- **–ê–ª–≥–æ—Ä–∏—Ç–º–∏—á–µ—Å–∫–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å**: –∏–∑–±–µ–≥–∞–π O(n¬≤) –æ–ø–µ—Ä–∞—Ü–∏–π
- **–ü–∞–º—è—Ç—å**: –º–∏–Ω–∏–º–∏–∑–∏—Ä—É–π –∞–ª–ª–æ–∫–∞—Ü–∏–∏
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ø—Ä–æ–≤–µ—Ä—è–π –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å cache keys

#### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:
```ruby
# ‚ùå –ü–õ–û–•–û: O(n¬≤) –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—è
def generate_large_code(nodes)
  result = ""
  nodes.each { |node| result += node.to_cpp }
  result
end

# ‚úÖ –•–û–†–û–®–û: O(n) –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
def generate_large_code(nodes)
  nodes.map(&:to_cpp).join("\n")
end
```

### 5. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

#### –ß—Ç–æ —Ä–µ–≤—å—é–∏—Ç—å:
- **–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ—Å—Ç—å**: –æ—à–∏–±–∫–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–Ω—è—Ç–Ω—ã–º–∏
- **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ**: –ø–∞—Ä—Å–µ—Ä –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–±–æ—Ç—É –ø–æ—Å–ª–µ –æ—à–∏–±–æ–∫
- **–õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è**: —Ç–æ—á–Ω–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ –º–µ—Å—Ç–∞ –æ—à–∏–±–∫–∏

#### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:
```ruby
# ‚ùå –ü–õ–û–•–û: –ù–µ–∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–∞—è –æ—à–∏–±–∫–∞
raise "Parse error"

# ‚úÖ –•–û–†–û–®–û: –î–µ—Ç–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞
raise ParseError.new(
  message: "Expected ')' but found '#{current_token.value}'",
  location: current_token.location,
  suggestion: "Did you mean to close the function parameter list?"
)
```

## –°–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞

### 1. AST —É–∑–ª—ã
- –í—Å–µ —É–∑–ª—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å immutable
- –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã —Å –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- –ú–µ—Ç–æ–¥—ã `to_cpp`, `to_source` –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

### 2. –ü–∞—Ä—Å–µ—Ä—ã
- –ò—Å–ø–æ–ª—å–∑—É–π memoization –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π –≤—Å–µ —Ç–æ–∫–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–π –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ –æ—à–∏–±–∫–∏

### 3. –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã
- –ò—Å–ø–æ–ª—å–∑—É–π StringBuilder –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç—Å—Ç—É–ø—ã
- –û–±–µ—Å–ø–µ—á–∏–≤–∞–π –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º–æ–≥–æ C++

## –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è —Ä–µ–≤—å—é

### –ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º:
- [ ] –ü–æ–Ω–∏–º–∞–µ—à—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞
- [ ] –ó–Ω–∞–µ—à—å –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- [ ] –ü–æ–Ω–∏–º–∞–µ—à—å flow: Aurora ‚Üí CoreIR ‚Üí C++ AST ‚Üí C++

### –í–æ –≤—Ä–µ–º—è —Ä–µ–≤—å—é:
- [ ] –ü—Ä–æ–≤–µ—Ä—è–µ—à—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –ø–∞—Ä—Å–∏–Ω–≥–∞
- [ ] –ü—Ä–æ–≤–µ—Ä—è–µ—à—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- [ ] –ò—â–µ—à—å –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- [ ] –ü—Ä–æ–≤–µ—Ä—è–µ—à—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
- [ ] –û—Ü–µ–Ω–∏–≤–∞–µ—à—å –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏

### –ü–æ—Å–ª–µ —Ä–µ–≤—å—é:
- [ ] –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
- [ ] –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–µ –¥–µ–≥—Ä–∞–¥–∏—Ä–æ–≤–∞–ª–∞
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞

## –ü—Ä–∏–º–µ—Ä—ã —Ö–æ—Ä–æ—à–∏—Ö –∏ –ø–ª–æ—Ö–∏—Ö –ø—Ä–∞–∫—Ç–∏–∫

### ‚ùå –ü–õ–û–•–ò–ï –ü–†–ê–ö–¢–ò–ö–ò:

```ruby
# 1. –ü—Ä—è–º–∞—è –º–∞–Ω–∏–ø—É–ª—è—Ü–∏—è AST –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–æ–∫
def add_method_to_class(klass, method)
  klass.methods << method  # –ú–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã
end

# 2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
def parse_expression
  # –ú–æ–∂–µ—Ç —É–ø–∞—Å—Ç—å –Ω–∞ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–º —Ç–æ–∫–µ–Ω–µ
  consume(:IDENTIFIER)
end

# 3. –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
def generate_class(klass)
  result = "class #{klass.name} {\n"
  klass.methods.each do |method|
    result += "  " + method.to_cpp + "\n"  # O(n¬≤)
  end
  result + "};\n"
end
```

### ‚úÖ –•–û–†–û–®–ò–ï –ü–†–ê–ö–¢–ò–ö–ò:

```ruby
# 1. Immutable AST —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏
def add_method_to_class(klass, method)
  klass.with_methods(klass.methods + [method])
end

# 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
def parse_expression
  case current.type
  when :IDENTIFIER
    parse_identifier_expression
  else
    raise ParseError.new(
      message: "Expected expression, got #{current.type}",
      location: current.location
    )
  end
end

# 3. –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
def generate_class(klass)
  methods = klass.methods.map { |m| "  " + m.to_cpp }.join("\n")
  "class #{klass.name} {\n#{methods}\n};\n"
end
```

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Ç—Ä–µ–±—É–µ—Ç –æ—Å–æ–±–æ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è –∫:
1. **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏** - –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–π –∫–æ–¥ –¥–æ–ª–∂–µ–Ω –∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å—Å—è
2. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** - –±–æ–ª—å—à–∏–µ –æ–±—ä–µ–º—ã –¥–∞–Ω–Ω—ã—Ö
3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é** - —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ç—Ä–µ–±—É–µ—Ç —Ç—â–∞—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
4. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏** - API –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–Ω—è—Ç–Ω—ã–º –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä—É–π –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏, –∑–∞—Ç–µ–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É, –∏ —Ç–æ–ª—å–∫–æ –ø–æ—Ç–æ–º —Å—Ç–∏–ª—å –∫–æ–¥–∞ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é.
